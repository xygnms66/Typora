# Cmake构建项目



之后运行

~~~
 hello/
        |– CMakeLists.txt
        |– build 
        |- src
        |- lib
~~~

cmake . 当前文件夹创建CMakeFiles

~~~
mkdir build
cd build
cmake ..
~~~

cmake ..  cmake文件在上一层，其他文件创建在了本层



## 理解cmake

CMake会生成一个构建流水线（build pipelines）文件。一个构建流水线文件可能是Visual Studio的 .sln 文件， Xcode的 .xcodeproj 文件 或者是Unix风格的 Makefile 文件。构建流水线文件也可能以其他形式出现。

要生成构建流水线文件，CMake需要知道**source**目录和**binary**目录。source目录会存放CMakeLists.txt 文件。 binary目录下存放CMake生成的构建流水线文件。你可以将binary目录放到任何位置，一个常见的做法是在CMakelist.txt下创建一个叫build的子目录作为binary目录。

![707876-20181007110819397-1491561975](D:\Pictures\typora\707876-20181007110819397-1491561975.png)



通过分离binary和source目录，你可以在任何时候删掉binary目录来回到干净的状态。你甚至可以创建多个binary目录，每一个对应不同的构建系统或者参数配置。

缓存（cache）也是一个重要的概念。它是binary目录下一个叫做 CMakeCache.txt 的文件，里面存放着缓存变量（cache variables）。缓存变量包括用户配置选项-例如CMakeDemo中的 DEMO_ENABLE_MULTISAMPLE 选项， 以及用于加入编译的预计算信息。binary文件夹一般不会加入版本管理，通常做法是每次clone时重新构建binary目录。

**配置（Configure）和生成（Generate）**

下文将介绍几种不同运行CMake的方式。但不管你如何运行，CMake都会执行以下两步： 配置（configure）和 生成（generate）。

![707876-20181007120041153-411945708](E:\Document\Typora\img\707876-20181007120041153-411945708.png)

[CMake 入门实战 | HaHack](https://www.hahack.com/codes/cmake/)



# 本地环境配置

### 配置环境

+ 安装protobuf   [Ubuntu16.04安装Protobuf - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/113809843)

+ 安装tensorTF   下载路径[third_party / TensorRT · GitLab](http://10.11.12.216/third_party/tensorrt)  

解压后移动到`/usr/local`文件下面即可

+ 安装QT    解压文件夹，修改cmake的格式
+ 安装opencv

~~不要在网上下载安装~~

步骤如下

~~~
cd opencv
mkdir build
cd build
cmake -D CMAKE_BUILD_TYPE=RELEASE -D \
CMAKE_INSTALL_PREFIX=/usr/local ..
~~~

报错   `You should create a separate directory for build files.`

解决   删除opencv文件夹里的CMakeCache.txt



下载gitlab这个版本的opencv库

![Snipaste_2021-08-12_10-10-36](E:\Document\Typora\img\Snipaste_2021-08-12_10-10-36.png)

git clone

+ 安装grpc  网上随便下个就可以了，cmake要用高版本的去编译







## 配置结果

注：opencv和



+ cmake

```
root@0a0e045475de:/data/dev-lxy/searcher/build# which cmake
/usr/local/bin/cmake
```

+ QT

`/data/Qt5.14.2`安装路径

+ cuda和tensorRT

![Snipaste_2021-08-09_11-30-36](E:\Document\Typora\img\Snipaste_2021-08-09_11-30-36.png)

+ protobuf

~~~
root@0a0e045475de:/data/dev-lxy/searcher/build# which protoc
/usr/local/bin/protoc
~~~



+ gRPC



+ OpenCV



### interesting point

+ 控制版本迭代

~~~
#if PROTOBUF_VERSION < 3012000
#error This file was generated by a newer version of protoc which is
#error incompatible with your Protocol Buffer headers. Please update
#error your headers.
#endif
#if 3012002 < PROTOBUF_MIN_PROTOC_VERSION
#error This file was generated by an older version of protoc which is
#error incompatible with your Protocol Buffer headers. Please
#error regenerate this file with a newer version of protoc.
#endif

#include <google/protobuf/port_undef.inc>
#include <google/protobuf/io/coded_stream.h>
#include <google/protobuf/arena.h>
#include <google/protobuf/arenastring.h>
#include <google/protobuf/generated_message_table_driven.h>
#include <google/protobuf/generated_message_util.h>
#include <google/protobuf/inlined_string_field.h>
#include <google/protobuf/metadata_lite.h>
~~~

